{{ define "main" }}

{{- partial "components/schema" . }}

{{ partial "page-title.html" . }}
{{- $params := partial "utils/get-params" . }}
{{- $image := partial "utils/get-image" . }}
{{- $badges := slice }}

<section class="section pt-0 h-product">
  <div class="container">
    <div class="row">
      <div class="col-lg-5 mb-4 mb-lg-0">
        <!-- product image slider -->
        <div class="product-slider">
          {{ $images := partial "utils/get-images" . }}
          {{ range $images }}
          <div data-image="{{ .RelPermalink }}">
            <img class="img-fluid w-100 u-photo" src="{{ .RelPermalink }}" alt="product-img">
          </div>
          {{ end }}
        </div>
      </div>
      <div class="col-lg-5 offset-lg-1">
        <h4 class="font-weight-medium p-name">{{ .Title }}</h4>
        {{ if .Params.Colour }}
        <p>{{ partial "utils/get-colour-name" .Params.Colour }}</p>
        {{ end }}
        <!-- rating star -->
        {{ if site.Params.rating.enable }}
        <div class="rw-ui-container"></div>
        {{ end }}
        <div class="my-4">
          {{ if .Params.PriceBefore }}
          <s>{{ .Params.PriceBefore | lang.FormatCurrency 2 .Site.Params.currency }}</s>
          {{ end }}
          <span class="lead text-primary font-weight-medium p-price">{{ .Params.Price | lang.FormatCurrency 2 .Site.Params.currency }}</span>
        </div>
        {{ if .Params.Colour }}
        <div class="my-4 variants-box">
          <h5>{{ with "Colours" }}{{ i18n . | default . }}{{ end }}</h5>
          <div class="btn-group" role="group" aria-label="{{ with "Colours" }}{{ i18n . | default . }}{{ end }}">
            {{ range where .Parent.Pages "Title" page.Title }}
            {{ $active := eq page.Params.Colour .Params.Colour }}
            {{ $page := . }}
            {{ with .Params.Colour }}
            {{ $name := partial "utils/get-colour-name" . }}
            {{ $rgb := partial "utils/get-colour-rgb" . }}
            <a href="{{ $page.RelPermalink }}"
              {{ if $active }}class="color-button active"{{ else }}class="color-button"{{ end }}
              {{ printf "background-color: %s" $rgb | printf "style=%q" | safeHTMLAttr }}
              {{ printf "alt=%q" $name | safeHTMLAttr }}
              {{ printf "title=%q" $name | safeHTMLAttr }}
              >&nbsp;</a>
            {{ end }}
            {{ end }}
          </div>
        </div>
        {{ end }}
        {{ if .Params.Sizes }}
        <div class="my-4 variants-box">
          <h5>{{ with "Sizes" }}{{ i18n . | default . }}{{ end }}</h5>
          <div class="btn-group btn-group-toggle" data-toggle="buttons" role="group" aria-label="{{ with "Sizes" }}{{ i18n . | default . }}{{ end }}">
            {{ range .Params.Sizes }}
            {{ $p := split . "(" }}
            {{ $name := index $p 0 }}
            {{ $size := index (split (index $p 1) ")") 0 }}
            <label class="btn btn-light btn-sizes">
              <input type="radio" name="size" {{ printf "id=%q" (print "size-" $name) | safeHTMLAttr }}>
                <span class="size-name">{{ $name }}</span><br><span class="size-detail">{{ $size }}</span>
              </input>
            </label>
            {{ end }}
          </div>
        </div>
        {{ end }}
        {{- $badges = $badges | append .Params.Badges }}
        {{ if $badges }}
        <div class="my-4">
          {{ range $badge := $badges }}
          {{ range $severity, $text := $badge }}
          <span class="badge badge-{{ $severity }} badge-medium">{{ $text }}</span>
          {{ end }}
          {{ end }}
        </div>
        {{ end }}

        <p>{{ .Params.ShortDescription | default .Description | markdownify }}</p>
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Product",
            "name": {{ .Title }},
            "description": {{ .Params.ShortDescription | default .Description | markdownify }},
            {{ if .Params.Manufacturer }}
            "manufacturer": {{ .Params.Manufacturer }},
            {{ end }}
            {{ if .Params.EAN }}
            "gtin13": {{ .Params.EAN }},
            {{ end }}
            {{ if .Params.Height }}
            "height": {{ .Params.Height }},
            {{ end }}
            {{ if .Params.Width }}
            "width": {{ .Params.Width }},
            {{ end }}
            {{ if .Params.Size }}
            "size": {{ .Params.Size }},
            {{ end }}
            {{ if .Params.Weight }}
            "weight": {
                "@type": "QuantitativeValue",
                "unitCode": "GRM",
                "unitText": "g",
                "value": {{ .Params.Weight }}
            }
            {{ end }}
            "image": {{ $image }},
            "sku": {{ .Params.ProductID }},
            "offers": {
                "@type": "Offer",
                "price": {{ .Params.Price }},
                "priceCurrency": {{ .Site.Params.currency }}
            }
        }
        </script>
        <button
          {{ if eq (default false $params.instoreonly) true }}
          class="btn btn-primary"
          {{ if gt (int $params.instock) 0 }}
          data-toggle="modal" data-target="#modal-book-test"
          {{ end }}
          {{ else }}
          class="cart-add-item btn btn-primary"
          {{ end }}
          {{ if and (eq (int $params.instock) 0) (eq (default false $params.orderable) true) }}
          data-toggle="modal" data-target="#modal-request-order"
          {{ end }}
          data-item-id="{{ .Params.ProductID }}"
          data-item-instock="{{ int $params.instock }}"
          data-item-name="{{ .Title }}" {{ if .Params.Images }}{{ range first 1 .Params.Images }} data-item-image="{{ $image }}"
          {{ end }}{{ end }}  data-item-price="{{ .Params.Price }}" data-item-url="{{ .Permalink }}" data-item-description="{{ .Params.ShortDescription | default .Description | markdownify }}">
          {{ if eq (int $params.instock) 0 }}
            {{ if eq (default false $params.orderable) true }}
              {{ with "Request to order" }}{{ i18n . | default . }}{{ end }}
            {{ else }}
              {{ with "Out of stock" }}{{ i18n . | default . }}{{ end }}
            {{ end }}
          {{ else }}
            {{ if eq (default false $params.instoreonly) true }}
              {{ with "Book a test" }}{{ i18n . | default . }}{{ end }}
            {{ else }}
              {{ with "Add to cart" }}{{ i18n . | default . }}{{ end }}
            {{ end }}
          {{ end }}
        </button>
        <div class="modal fade" id="modal-book-test" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content border-0 rounded-0">
              <div class="modal-header">
                <h5 class="modal-title">{{ with "Book a test (title)" }}{{ i18n . | default . }}{{ end }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <form action="{{ site.Params.contact.formAction }}" method="POST">
                <div class="modal-body">
                  <p>{{ with "Book a test (description)" }}{{ i18n . | default . }}{{ end }}</p>
                  <input type="text" class="form-control mb-2" id="name" name="name" placeholder="{{ with "Name" }}{{ i18n . | default . }}{{ end }}">
                  <input type="email" class="form-control mb-2" id="email" name="email" placeholder="{{ with "Email" }}{{ i18n . | default . }}{{ end }}">
                  <input type="tel" class="form-control mb-2" id="phone" name="phone" placeholder="+421">
                  <input type="hidden" name="item-name" value="{{ .Params.Title }}">
                  <input type="hidden" name="item-id" value="{{ .Params.ProductID }}">
                  <input type="hidden" name="item-price" value="{{ .Params.Price }}">
                  <input type="hidden" name="item-colour" value="{{ .Params.Colour }}">
                  <textarea name="message" id="message" class="form-control mb-2" placeholder="{{ with "Additional notes" }}{{ i18n . | default . }}{{ end }}"></textarea>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">{{ with "Close" }}{{ i18n . | default . }}{{ end }}</button>
                  <button type="submit" value="send" class="btn btn-primary">{{ with "Send" }}{{ i18n . | default . }}{{ end }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="modal fade" id="modal-request-order" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content border-0 rounded-0">
              <div class="modal-header">
                <h5 class="modal-title">{{ with "Request to order" }}{{ i18n . | default . }}{{ end }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p>{{ with "request-order-description-text" }}{{ i18n . | default . }}{{ end }}</p>
                <form action="{{ site.Params.contact.formAction }}" method="POST">
                  <input type="text" class="form-control mb-2" id="name" name="name" placeholder="{{ with "Name" }}{{ i18n . | default . }}{{ end }}">
                  <input type="email" class="form-control mb-2" id="email" name="email" placeholder="{{ with "Email" }}{{ i18n . | default . }}{{ end }}">
                  <input type="tel" class="form-control mb-2" id="phone" name="phone" placeholder="+421">
                  <input type="hidden" name="item-name" value="{{ .Params.Title }}">
                  <input type="hidden" name="item-id" value="{{ .Params.ProductID }}">
                  <input type="hidden" name="item-price" value="{{ .Params.Price }}">
                  <input type="hidden" name="item-colour" value="{{ .Params.Colour }}">
                  <textarea name="message" id="message" class="form-control mb-2" placeholder="{{ with "Additional notes" }}{{ i18n . | default . }}{{ end }}"></textarea>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{{ with "Close" }}{{ i18n . | default . }}{{ end }}</button>
                <button type="submit" value="send" class="btn btn-primary">{{ with "Send" }}{{ i18n . | default . }}{{ end }}</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 mt-1">
        <ul class="nav nav-tabs border-bottom-0" id="myTab" role="tablist">
          <li class="nav-item mr-3">
            <a class="nav-link active" id="description-tab" data-toggle="tab" href="#description" role="tab"
              aria-controls="description" aria-selected="true">{{ with "Description" }}{{ i18n . | default . }}{{ end }}</a>
          </li>
          <!--
          <li class="nav-item">
            <a class="nav-link" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews"
              aria-selected="false">{{ with "Reviews" }}{{ i18n . | default . }}{{ end }}</a>
          </li>
          -->
          <li class="nav-item">
            <a class="nav-link" id="specs-tab" data-toggle="tab" href="#specs" role="tab" aria-controls="reviews"
              aria-selected="false">{{ with "Specifications" }}{{ i18n . | default . }}{{ end }}</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active e-description" id="description" role="tabpanel" aria-labelledby="description-tab">
            <div class="content">{{ .Content }}</div>
          </div>
          <!--
          <div class="tab-pane fade p-review" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
            {{ template "_internal/disqus.html" . }}
          </div>
          -->
          <div class="tab-pane fade" id="specs" role="tabpanel" aria-labelledby="specs-tab">
            <div class="content">
              <table class="table">
                <tbody>
                  {{ range slice "manufacturer" "model" "productID" "EAN" "weight" "maximum_load" "width" "height" "size" }}
                  {{ if index $params . }}
                  <tr>
                    <th scope="row">{{ i18n (humanize .) | default (humanize .) }}</th>
                    <td>{{ index $params . }}</td>
                  </tr>
                  {{ end }}
                  {{ end }}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{{ partial "cta.html" . }}

{{ end }}
